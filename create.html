<!doctype html>
<html lang="en">
    <head>
        <title>Create a cryptic clue</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />
        <meta name="keywords" content="cryptic, crossword, clues" />
        <meta
            name="description"
            content="Create a cryptic crossword clue and share it with people you know."
        />
        <meta property="og:title" content="Cryptick" />
        <meta property="og:site_name" content="Cryptick" />
        <meta property="og:image" content="./logo.svg" />
        <meta property="og:image:height" content="1200" />
        <meta property="og:image:width" content="1200" />
        <link rel="stylesheet" href="./base.css" />
        <link rel="icon" href="./logo.svg" />
        <style>
            main {
                grid-template:
                    'maker' auto
                    'copy' 15%
                    'keyboard' env(keyboard-inset-height, 0px);
            }

            .clue_maker {
                display: inline-grid;
                grid-row: 1;
                row-gap: 1em;
                padding: 2em 0;
            }

            .clue_maker__input {
                border: none;
                border-radius: 5px;
            }

            .clue_maker__input--answer {
                text-transform: uppercase;
            }

            .clue_maker__label {
                text-align: left;
            }

            .clue_maker:invalid + * > .pill {
                pointer-events: none;
                background: var(--colour-grey);
                cursor: not-allowed;
            }

            .list {
                grid-row: 2;
            }
        </style>
    </head>
    <body>
        <header>
            <a href="./"><h1>Cryptâœ”ck</h1></a>
        </header>
        <main>
            <form class="clue_maker">
                <label class="header clue_maker__label" for="clue">Clue</label>
                <textarea
                    class="input clue_maker__input input--clue"
                    id="clue"
                    name="clue"
                    placeholder="Slam nonsense tales"
                    required
                    minlength="1"
                    rows="4"
                ></textarea>
                <label class="header clue_maker__label" for="answer"
                    >Answer</label
                >
                <input
                    class="input clue_maker__input clue_maker__input--answer"
                    id="answer"
                    name="answer"
                    placeholder="SLATE"
                    required
                    minlength="1"
                    maxlength="15"
                />
                <label class="header clue_maker__label" for="hint"
                    >Hint (Optional)</label
                >
                <textarea
                    class="input clue_maker__input"
                    id="hint"
                    name="hint"
                    placeholder="'Nonsense' indicates an anagram of nearby letters"
                ></textarea>
            </form>
            <div class="list">
                <button class="pill" id="copy">Copy to clipboard</button>
                <button class="pill" id="open">Open in new tab</button>
            </div>
            <script type="module">
                import { ClueEncoder } from './miniclue/encoder.js';
                import { MiniClue } from './miniclue/index.js';

                function buildClue() {
                    let encoded = ClueEncoder.encode(
                        document.getElementById('clue').value,
                        document.getElementById('answer').value,
                        document.getElementById('hint').value,
                    );

                    return `${window.location.origin}${window.location.pathname.replace('create', 'clue')}#${encoded}`;
                }

                document.getElementById('copy').onclick = (_) => {
                    const message = [
                        `${document.getElementById('clue').value} (${MiniClue.enumerate(document.getElementById('answer').value)})`,
                        buildClue(),
                        'Solve it, and create your own!',
                    ].join('\n\n');

                    navigator.clipboard.writeText(message);
                    document.getElementById('copy').textContent = 'Copied!';
                };

                document.getElementById('open').onclick = (_) => {
                    window.open(buildClue()).focus();
                };
            </script>
        </main>
        <footer>
            <a href="https://github.com/mrwilson/guess-the-clue">Open source</a>
            and made with <3 by
            <a href="https://www.wildvale.co.uk/">Wildvale</a>
        </footer>
    </body>
</html>
